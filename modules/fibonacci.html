<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fibonacci: Los Secretos Matem√°ticos de la Naturaleza</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/plotly.js/2.18.0/plotly.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 25%, #f093fb 50%, #f5576c 75%, #4facfe 100%);
            color: #2c3e50;
            overflow-x: hidden;
            line-height: 1.6;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .hero-section {
            text-align: center;
            padding: 80px 0;
            background: linear-gradient(45deg, rgba(255, 255, 255, 0.95), rgba(255, 255, 255, 0.85));
            backdrop-filter: blur(20px);
            border-radius: 30px;
            margin-bottom: 50px;
            animation: fadeInUp 1s ease-out;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .hero-title {
            font-size: 4rem;
            font-weight: 800;
            background: linear-gradient(45deg, #FF6B6B, #4ECDC4, #45B7D1, #96CEB4, #FFEAA7);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 20px;
            animation: glow 3s ease-in-out infinite alternate;
            text-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .hero-subtitle {
            font-size: 1.4rem;
            margin-bottom: 30px;
            color: #2c3e50;
            font-weight: 600;
        }

        .section {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.95), rgba(255, 255, 255, 0.9));
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 25px;
            padding: 50px;
            margin: 40px 0;
            transition: all 0.4s ease;
            animation: slideIn 0.8s ease-out;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }

        .section:hover {
            transform: translateY(-15px);
            box-shadow: 0 30px 60px rgba(0, 0, 0, 0.15);
        }

        .section-title {
            font-size: 2.8rem;
            background: linear-gradient(45deg, #FF6B6B, #4ECDC4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 30px;
            text-align: center;
            font-weight: 700;
        }

        .fibonacci-sequence {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 20px;
            margin: 40px 0;
        }

        .fib-number {
            background: linear-gradient(45deg, #FF6B6B, #4ECDC4);
            color: white;
            padding: 20px 25px;
            border-radius: 50%;
            font-weight: bold;
            font-size: 1.4rem;
            animation: bounce 0.8s ease-in-out;
            transition: all 0.3s ease;
            cursor: pointer;
            box-shadow: 0 10px 25px rgba(255, 107, 107, 0.3);
        }

        .fib-number:hover {
            transform: scale(1.3) rotate(10deg);
            box-shadow: 0 15px 35px rgba(255, 107, 107, 0.5);
        }

        .rabbit-container {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 20px;
            margin: 40px 0;
            justify-items: center;
        }

        .rabbit-month {
            text-align: center;
            background: linear-gradient(135deg, rgba(78, 205, 196, 0.2), rgba(69, 183, 209, 0.2));
            padding: 20px;
            border-radius: 20px;
            transition: all 0.4s ease;
            border: 2px solid rgba(78, 205, 196, 0.3);
            min-height: 150px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .rabbit-month:hover {
            background: linear-gradient(135deg, rgba(78, 205, 196, 0.4), rgba(69, 183, 209, 0.4));
            transform: scale(1.05);
            border-color: #4ECDC4;
        }

        .rabbit-display {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(20px, 1fr));
            gap: 3px;
            margin: 10px 0;
            min-height: 60px;
            align-content: start;
        }

        .rabbit-pair {
            font-size: 1.2rem;
            text-align: center;
        }

        .rabbit-info {
            font-weight: bold;
            color: #2c3e50;
        }

        .fib-highlight {
            background: linear-gradient(45deg, #FFD700, #FFA500);
            color: #000;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 1.2rem;
            font-weight: bold;
        }

        .controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 30px;
            margin: 40px 0;
            flex-wrap: wrap;
        }

        .slider {
            width: 250px;
            height: 8px;
            border-radius: 5px;
            background: linear-gradient(to right, #FF6B6B, #4ECDC4);
            outline: none;
            -webkit-appearance: none;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            background: linear-gradient(45deg, #FF6B6B, #4ECDC4);
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }

        .btn {
            background: linear-gradient(45deg, #FF6B6B, #4ECDC4);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 30px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-size: 1rem;
            box-shadow: 0 8px 20px rgba(255, 107, 107, 0.3);
        }

        .btn:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(255, 107, 107, 0.4);
        }

        .color-palette-btn {
            background: linear-gradient(45deg, #FF6B6B, #4ECDC4, #FFD700, #98FB98);
            font-size: 1.5rem;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 10px;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            backdrop-filter: blur(10px);
        }

        .modal-content {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.95), rgba(255, 255, 255, 0.9));
            margin: 5% auto;
            padding: 40px;
            border-radius: 30px;
            width: 90%;
            max-width: 600px;
            box-shadow: 0 30px 60px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.3);
            position: relative;
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            position: absolute;
            right: 20px;
            top: 15px;
        }

        .close:hover {
            color: #FF6B6B;
        }

        .color-controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .color-group {
            background: rgba(255, 255, 255, 0.5);
            padding: 20px;
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .color-input {
            width: 100%;
            height: 50px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            margin: 10px 0;
        }

        .nature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 40px;
            margin: 50px 0;
        }

        .nature-card {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.9), rgba(255, 255, 255, 0.8));
            border-radius: 25px;
            padding: 40px;
            text-align: center;
            transition: all 0.4s ease;
            border: 2px solid rgba(255, 107, 107, 0.2);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
        }

        .nature-card:hover {
            transform: translateY(-15px) scale(1.02);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
            border-color: #FF6B6B;
        }

        .nature-emoji {
            font-size: 5rem;
            margin-bottom: 25px;
            display: block;
        }

        .interactive-demo {
            background: linear-gradient(135deg, rgba(78, 205, 196, 0.1), rgba(69, 183, 209, 0.1));
            border-radius: 20px;
            padding: 30px;
            margin: 30px 0;
            border: 1px solid rgba(78, 205, 196, 0.3);
        }

        .calculator {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.95), rgba(255, 255, 255, 0.9));
            border-radius: 25px;
            padding: 40px;
            margin: 40px 0;
            text-align: center;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
        }

        .calc-input {
            background: linear-gradient(135deg, rgba(78, 205, 196, 0.1), rgba(69, 183, 209, 0.1));
            border: 3px solid rgba(78, 205, 196, 0.5);
            border-radius: 15px;
            padding: 20px;
            color: #2c3e50;
            font-size: 1.3rem;
            text-align: center;
            margin: 15px;
            width: 120px;
            font-weight: bold;
        }

        .calc-result {
            font-size: 2.5rem;
            background: linear-gradient(45deg, #FF6B6B, #4ECDC4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin: 30px 0;
            font-weight: bold;
        }

        .golden-ratio {
            font-size: 1.8rem;
            background: linear-gradient(45deg, #FF6B6B, #4ECDC4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-align: center;
            margin: 30px 0;
            font-weight: bold;
        }

        .visualization-container {
            background: white;
            border-radius: 20px;
            padding: 20px;
            margin: 30px 0;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .sunflower-container {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 40px;
            background: linear-gradient(135deg, #FFEAA7, #FDCB6E);
            border-radius: 20px;
            margin: 30px 0;
            height: 600px;
        }

        .spiral-widget {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.95), rgba(255, 255, 255, 0.9));
            border-radius: 15px;
            padding: 15px;
            margin: 10px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            border: 2px solid rgba(255, 107, 107, 0.3);
        }

        .spiral-control {
            display: flex;
            align-items: center;
            margin: 10px 0;
            font-weight: bold;
            color: #2c3e50;
        }

        .spiral-control input[type="checkbox"] {
            width: 20px;
            height: 20px;
            margin-right: 10px;
            cursor: pointer;
        }

        .spiral-count {
            background: linear-gradient(45deg, #FFD700, #FFA500);
            color: #000;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 1.1rem;
            font-weight: bold;
            margin-left: 10px;
        }

        .flower-gallery {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 30px;
            margin: 30px 0;
        }

        .flower-item {
            text-align: center;
            padding: 25px;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.9), rgba(255, 255, 255, 0.8));
            border-radius: 20px;
            transition: all 0.3s ease;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }

        .flower-item:hover {
            transform: scale(1.05);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.15);
        }

        .tree-container {
            display: flex;
            justify-content: center;
            padding: 40px;
            background: linear-gradient(135deg, #A8E6CF, #81C784);
            border-radius: 20px;
            margin: 30px 0;
            position: relative;
            height: 600px;
        }

        .tree-info {
            position: absolute;
            top: 10px;
            left: 20px;
            background: rgba(255, 255, 255, 0.9);
            padding: 15px;
            border-radius: 10px;
            font-size: 0.9rem;
            color: #2c3e50;
        }

        .butterfly-container {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 40px;
            background: linear-gradient(135deg, #FFB3E6, #FFC3A0);
            border-radius: 20px;
            margin: 30px 0;
        }

        .canvas-container {
            display: flex;
            justify-content: center;
            margin: 30px 0;
        }

        .drawing-canvas {
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            background: white;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(60px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-60px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% {
                transform: translateY(0);
            }
            40% {
                transform: translateY(-15px);
            }
            60% {
                transform: translateY(-8px);
            }
        }

        @keyframes glow {
            from {
                filter: drop-shadow(0 0 10px rgba(255, 107, 107, 0.5));
            }
            to {
                filter: drop-shadow(0 0 25px rgba(78, 205, 196, 0.8));
            }
        }

        @keyframes rotate {
            from {
                transform: rotate(0deg);
            }
            to {
                transform: rotate(360deg);
            }
        }

        .spiral-controls {
            text-align: center;
            margin: 20px 0;
        }

        @media (max-width: 768px) {
            .hero-title {
                font-size: 3rem;
            }
            
            .section {
                padding: 30px;
            }
            
            .controls {
                flex-direction: column;
            }
            
            .nature-grid {
                grid-template-columns: 1fr;
            }
            
            .rabbit-container {
                grid-template-columns: repeat(3, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Hero Section -->
        <div class="hero-section">
            <h1 class="hero-title">üå∫ FIBONACCI üå∫</h1>
            <p class="hero-subtitle">Descubre los patrones matem√°ticos que crean la belleza del universo</p>
            <p>Donde las matem√°ticas cobran vida en la naturaleza</p>
        </div>

        <!-- Introducci√≥n -->
        <div class="section">
            <h2 class="section-title">üî¢ La Secuencia M√°gica</h2>
            <p style="font-size: 1.3rem; text-align: center; margin-bottom: 40px; color: #2c3e50;">
                Cada n√∫mero es la suma de los dos anteriores, creando una progresi√≥n que gobierna la naturaleza
            </p>
            
            <div class="fibonacci-sequence" id="fibSequence">
                <!-- Los n√∫meros se generar√°n din√°micamente -->
            </div>
            
            <div class="golden-ratio">
                ‚ú® Proporci√≥n √Åurea (œÜ): <span id="goldenRatio">1.618033988...</span>
            </div>
        </div>

        <!-- El Problema de los Conejos Mejorado -->
        <div class="section">
            <h2 class="section-title">üê∞ El Experimento de Fibonacci</h2>
            <p style="text-align: center; margin-bottom: 40px; font-size: 1.2rem; color: #2c3e50;">
                Cada mes, cada pareja madura produce una nueva pareja. Las parejas j√≥venes necesitan un mes para madurar.
            </p>
            
            <div class="controls">
                <label style="color: #2c3e50; font-weight: bold;">Mes: <input type="range" class="slider" id="monthSlider" min="1" max="12" value="6"></label>
                <span style="color: #2c3e50; font-weight: bold;">Mes <span id="currentMonth">6</span></span>
                <button class="btn" onclick="animateRabbits()">üé¨ Simular Crecimiento</button>
                <button class="btn" onclick="resetRabbitAnimation()">üîÑ Reiniciar</button>
            </div>
            
            <div class="rabbit-container" id="rabbitContainer">
                <!-- Los conejos se generar√°n din√°micamente -->
            </div>
        </div>

        <!-- Visualizaci√≥n Gr√°fica -->
        <div class="section">
            <h2 class="section-title">üìä Crecimiento Exponencial</h2>
            <div class="controls">
                <label style="color: #2c3e50; font-weight: bold;">T√©rminos: <input type="range" class="slider" id="termsSlider" min="5" max="25" value="12"></label>
                <span style="color: #2c3e50; font-weight: bold;"><span id="termsCount">12</span> t√©rminos</span>
                <button class="btn" onclick="updateChart()">üìà Actualizar</button>
                <button class="color-palette-btn" onclick="openColorModal()">üé®</button>
            </div>
            <div class="visualization-container">
                <div id="fibonacciChart" style="width:100%;height:450px;"></div>
            </div>
        </div>

        <!-- Modal de Colores -->
        <div id="colorModal" class="modal">
            <div class="modal-content">
                <span class="close" onclick="closeColorModal()">&times;</span>
                <h2 style="text-align: center; margin-bottom: 30px; color: #2c3e50;">üé® Personaliza los Colores</h2>
                <div class="color-controls">
                    <div class="color-group">
                        <h3>Gr√°fico Principal</h3>
                        <label>Color de l√≠nea:</label>
                        <input type="color" class="color-input" id="lineColor" value="#FF6B6B">
                        <label>Color de puntos:</label>
                        <input type="color" class="color-input" id="pointColor" value="#4ECDC4">
                    </div>
                    <div class="color-group">
                        <h3>Girasol</h3>
                        <label>Semillas centrales:</label>
                        <input type="color" class="color-input" id="centerSeedColor" value="#8B4513">
                        <label>Semillas exteriores:</label>
                        <input type="color" class="color-input" id="outerSeedColor" value="#DEB887">
                    </div>
                    <div class="color-group">
                        <h3>Espiral</h3>
                        <label>Color de cuadrados:</label>
                        <input type="color" class="color-input" id="squareColor" value="#FF6B6B">
                        <label>Color de espiral:</label>
                        <input type="color" class="color-input" id="spiralColor" value="#FFD700">
                    </div>
                </div>
                <div style="text-align: center; margin-top: 30px;">
                    <button class="btn" onclick="applyColors()">‚ú® Aplicar Colores</button>
                    <button class="btn" onclick="resetColors()">üîÑ Restaurar</button>
                </div>
            </div>
        </div>

        <!-- Espiral de Fibonacci Corregida -->
        <div class="section">
            <h2 class="section-title">üåÄ La Espiral Sagrada</h2>
            <p style="text-align: center; margin-bottom: 40px; color: #2c3e50; font-size: 1.2rem;">
                Cuadrados con lados de Fibonacci + arcos de cuarto de c√≠rculo = ¬°La espiral dorada perfecta!
            </p>
            <div class="visualization-container">
                <div id="fibonacciSpiral" style="width:100%;height:500px;"></div>
            </div>
            <div class="spiral-controls">
                <button class="btn" onclick="drawFibonacciSpiral()">üé® Crear Espiral</button>
                <button class="btn" onclick="animateSpiral()">‚ú® Animar</button>
            </div>
        </div>

        <!-- Girasol MEJORADO - Simulaci√≥n Estrella -->
        <div class="section">
            <h2 class="section-title">üåª El Girasol Matem√°tico - ¬°La Magia de Fibonacci!</h2>
            <p style="text-align: center; margin-bottom: 30px; color: #2c3e50; font-size: 1.3rem;">
                <strong>¬°La simulaci√≥n m√°s fascinante!</strong> Observa c√≥mo surgen espirales perfectas de Fibonacci
            </p>
            
            <div class="sunflower-container">
                <div id="sunflowerPattern" style="width: 100%; height: 550px;"></div>
            </div>
            
            <div class="controls">
                <label style="color: #2c3e50; font-weight: bold;">Semillas: <input type="range" class="slider" id="seedSlider" min="50" max="800" value="400"></label>
                <span style="color: #2c3e50; font-weight: bold;"><span id="seedCount">400</span> semillas</span>
                <button class="btn" onclick="createSunflower()">üåª Generar Girasol</button>
            </div>
            
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin: 30px 0;">
                <div class="spiral-widget">
                    <h3 style="color: #2c3e50; text-align: center; margin-bottom: 15px;">üî¥ Espirales Horarias</h3>
                    <div class="spiral-control">
                        <input type="checkbox" id="showSpiralsClockwise" checked>
                        <span>Mostrar espirales ‚û°Ô∏è</span>
                        <span class="spiral-count" id="clockwiseCount">21</span>
                    </div>
                    <p style="font-size: 0.9rem; color: #666; margin-top: 10px;">
                        L√≠neas rojas que giran hacia la derecha
                    </p>
                </div>
                
                <div class="spiral-widget">
                    <h3 style="color: #2c3e50; text-align: center; margin-bottom: 15px;">üîµ Espirales Antihorarias</h3>
                    <div class="spiral-control">
                        <input type="checkbox" id="showSpiralsCounterclockwise" checked>
                        <span>Mostrar espirales ‚¨ÖÔ∏è</span>
                        <span class="spiral-count" id="counterclockwiseCount">34</span>
                    </div>
                    <p style="font-size: 0.9rem; color: #666; margin-top: 10px;">
                        L√≠neas azules que giran hacia la izquierda
                    </p>
                </div>
                
                <div class="spiral-widget">
                    <h3 style="color: #2c3e50; text-align: center; margin-bottom: 15px;">‚ú® Proporci√≥n √Åurea</h3>
                    <div style="text-align: center;">
                        <div style="font-size: 1.5rem; color: #FF6B6B; font-weight: bold;" id="fibonacciRatio">34/21 = 1.619</div>
                        <div style="font-size: 1.2rem; color: #4ECDC4;">‚âà œÜ (1.618...)</div>
                    </div>
                    <p style="font-size: 0.9rem; color: #666; margin-top: 10px;">
                        ¬°N√∫meros consecutivos de Fibonacci!
                    </p>
                </div>
            </div>
            
            <div style="background: rgba(255, 255, 255, 0.95); padding: 25px; border-radius: 20px; margin: 20px 0; border: 2px solid #FFD700;">
                <h3 style="color: #2c3e50; text-align: center; margin-bottom: 15px;">ü§î ¬øPor qu√© aparecen estas espirales?</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                    <div>
                        <h4 style="color: #FF6B6B;">üîç El Secreto:</h4>
                        <p style="color: #2c3e50; line-height: 1.6;">
                            Cada semilla se coloca con un √°ngulo de <strong>137.5¬∞</strong> (√°ngulo dorado). 
                            Este √°ngulo m√°gico hace que las semillas autom√°ticamente formen espirales de Fibonacci.
                        </p>
                    </div>
                    <div>
                        <h4 style="color: #4ECDC4;">üìä La Matem√°tica:</h4>
                        <p style="color: #2c3e50; line-height: 1.6;">
                            Si cuentas espirales en una direcci√≥n obtienes un n√∫mero de Fibonacci (ej: 21). 
                            Si cuentas en la otra direcci√≥n obtienes el <strong>siguiente</strong> n√∫mero (34).
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Flores Corregidas -->
        <div class="section">
            <h2 class="section-title">üå∏ Galer√≠a de P√©talos Fibonacci</h2>
            <p style="text-align: center; margin-bottom: 40px; color: #2c3e50; font-size: 1.2rem;">
                Flores reales con n√∫meros exactos de p√©talos de Fibonacci
            </p>
            <div class="flower-gallery">
                <div class="flower-item">
                    <div id="flower3" style="width: 100%; height: 200px;"></div>
                    <h3 style="color: #2c3e50;">Lirio - 3 p√©talos exactos</h3>
                </div>
                <div class="flower-item">
                    <div id="flower5" style="width: 100%; height: 200px;"></div>
                    <h3 style="color: #2c3e50;">Rosa Silvestre - 5 p√©talos exactos</h3>
                </div>
                <div class="flower-item">
                    <div id="flower8" style="width: 100%; height: 200px;"></div>
                    <h3 style="color: #2c3e50;">Cosmos - 8 p√©talos exactos</h3>
                </div>
                <div class="flower-item">
                    <div id="flower13" style="width: 100%; height: 200px;"></div>
                    <h3 style="color: #2c3e50;">Margarita - 13 p√©talos exactos</h3>
                </div>
            </div>
            <div class="controls">
                <button class="btn" onclick="createAllFlowers()">üå∫ Crear Flores</button>
                <button class="btn" onclick="animateFlowers()">‚ú® Animar</button>
            </div>
        </div>

        <!-- √Årbol Mejorado -->
        <div class="section">
            <h2 class="section-title">üå≤ √Årbol de Fibonacci</h2>
            <p style="text-align: center; margin-bottom: 30px; color: #2c3e50; font-size: 1.2rem;">
                Cada nivel multiplica las ramas seg√∫n la secuencia de Fibonacci
            </p>
            <div class="tree-container">
                <div class="tree-info">
                    <strong>Nivel <span id="currentTreeLevel">5</span></strong><br>
                    Ramas: <span id="branchCount">5</span><br>
                    Patr√≥n: F(<span id="fibIndex">5</span>) = <span id="fibValue">5</span>
                </div>
                <canvas id="treeCanvas" width="700" height="550" class="drawing-canvas"></canvas>
            </div>
            <div class="controls">
                <label style="color: #2c3e50; font-weight: bold;">Nivel: <input type="range" class="slider" id="treeLevel" min="1" max="8" value="5"></label>
                <span style="color: #2c3e50; font-weight: bold;">Nivel <span id="treeLevelText">5</span> (F(5) = 5 ramas)</span>
                <button class="btn" onclick="createTree()">üå≥ Crecer √Årbol</button>
            </div>
        </div>

        <!-- Mariposa Hermosa -->
        <div class="section">
            <h2 class="section-title">ü¶ã Mariposa Dorada</h2>
            <p style="text-align: center; margin-bottom: 30px; color: #2c3e50; font-size: 1.2rem;">
                Alas dise√±adas con proporciones √°ureas perfectas y patrones fractales
            </p>
            <div class="butterfly-container">
                <div id="butterflyWings" style="width: 100%; height: 400px;"></div>
            </div>
            <div class="controls">
                <button class="btn" onclick="createButterfly()">ü¶ã Crear Mariposa</button>
                <button class="btn" onclick="animateButterfly()">‚ú® Volar</button>
            </div>
        </div>

        <!-- Otras secciones de la naturaleza -->
        <div class="section">
            <h2 class="section-title">üåø M√°s Patrones en la Naturaleza</h2>
            <div class="nature-grid">
                <div class="nature-card">
                    <span class="nature-emoji">üêö</span>
                    <h3>Conchas Nautilius</h3>
                    <div class="interactive-demo">
                        <p><strong>Crecimiento logar√≠tmico perfecto</strong></p>
                        <p>Cada c√°mara es œÜ veces m√°s grande</p>
                        <p>œÜ = 1.618... (Proporci√≥n √Åurea)</p>
                    </div>
                </div>
                
                <div class="nature-card">
                    <span class="nature-emoji">üçç</span>
                    <h3>Pi√±as y Conos</h3>
                    <div class="interactive-demo">
                        <p><strong>Espirales dobles:</strong></p>
                        <p>‚ÜóÔ∏è 8 espirales hacia la derecha</p>
                        <p>‚ÜñÔ∏è 13 espirales hacia la izquierda</p>
                        <p>Ratio: 13/8 ‚âà 1.625 ‚âà œÜ</p>
                    </div>
                </div>
                
                <div class="nature-card">
                    <span class="nature-emoji">üåå</span>
                    <h3>Galaxias Espirales</h3>
                    <div class="interactive-demo">
                        <p><strong>V√≠a L√°ctea incluida:</strong></p>
                        <p>Los brazos espirales siguen la proporci√≥n √°urea</p>
                        <p>Expansi√≥n: cada vuelta es œÜ veces mayor</p>
                    </div>
                </div>
                
                <div class="nature-card">
                    <span class="nature-emoji">üß¨</span>
                    <h3>ADN Humano</h3>
                    <div class="interactive-demo">
                        <p><strong>Dimensiones Fibonacci:</strong></p>
                        <p>Ancho: 21 √Ö (√Ångstrom)</p>
                        <p>Longitud de vuelta: 34 √Ö</p>
                        <p>Ratio: 34/21 ‚âà 1.619 ‚âà œÜ</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Calculadora Interactiva -->
        <div class="section">
            <h2 class="section-title">üßÆ Calculadora Fibonacci</h2>
            <div class="calculator">
                <p style="color: #2c3e50; font-size: 1.2rem;">Explora cualquier t√©rmino de la secuencia:</p>
                <input type="number" class="calc-input" id="fibInput" min="0" max="50" value="10" placeholder="n">
                <button class="btn" onclick="calculateFibonacci()">Calcular F(n)</button>
                <div class="calc-result" id="fibResult">F(10) = 55</div>
                <p style="margin-top: 25px; color: #2c3e50; font-size: 1.1rem;">
                    <strong>F√≥rmula:</strong> F(n) = F(n-1) + F(n-2), donde F(0) = 0 y F(1) = 1
                </p>
            </div>
        </div>

        <!-- Conclusi√≥n -->
        <div class="section">
            <h2 class="section-title">‚ú® El C√≥digo Universal</h2>
            <p style="font-size: 1.3rem; text-align: center; line-height: 1.9; color: #2c3e50;">
                La secuencia de Fibonacci revela que las matem√°ticas no son abstractas,
                sino <strong style="background: linear-gradient(45deg, #FF6B6B, #4ECDC4); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">el lenguaje fundamental del universo</strong>.
                Desde la espiral de una galaxia hasta la estructura de nuestro ADN,
                todo sigue este patr√≥n sagrado de crecimiento y belleza.
            </p>
            <div style="text-align: center; margin-top: 40px;">
                <span style="font-size: 2.5rem;">üåü ¬°Las matem√°ticas est√°n vivas! üåü</span>
            </div>
        </div>
    </div>

    <script>
        // Variable global para verificar si Plotly est√° cargado
        let plotlyLoaded = false;
        let currentColors = {
            line: '#FF6B6B',
            point: '#4ECDC4',
            centerSeed: '#000000',
            outerSeed: '#FFFFFF',
            square: '#FF6B6B',
            spiral: '#FFD700'
        };
        
        // Esperar a que se cargue Plotly
        function waitForPlotly() {
            return new Promise((resolve) => {
                if (typeof Plotly !== 'undefined') {
                    plotlyLoaded = true;
                    resolve();
                } else {
                    setTimeout(() => waitForPlotly().then(resolve), 100);
                }
            });
        }

        // Generar secuencia de Fibonacci optimizada
        function fibonacciOptimized(n) {
            if (n <= 1) return n;
            let a = 0, b = 1, temp;
            for (let i = 2; i <= n; i++) {
                temp = a + b;
                a = b;
                b = temp;
            }
            return b;
        }

        // Inicializar la secuencia visual
        function initFibonacciSequence() {
            const container = document.getElementById('fibSequence');
            if (!container) return;
            
            const sequence = [0, 1, 1, 2, 3, 5, 8, 13, 21, 34, 55, 89, 144];
            
            container.innerHTML = '';
            sequence.forEach((num, index) => {
                setTimeout(() => {
                    const span = document.createElement('span');
                    span.className = 'fib-number';
                    span.textContent = num;
                    span.style.animationDelay = `${index * 0.1}s`;
                    container.appendChild(span);
                }, index * 250);
            });
        }

        // Simulaci√≥n mejorada de conejos
        function initRabbits() {
            const container = document.getElementById('rabbitContainer');
            if (!container) return;
            
            const fibSequence = [1, 1, 2, 3, 5, 8, 13, 21, 34, 55, 89, 144];
            
            container.innerHTML = '';
            for (let i = 0; i < 12; i++) {
                const monthDiv = document.createElement('div');
                monthDiv.className = 'rabbit-month';
                
                const pairs = fibSequence[i];
                const displayPairs = Math.min(pairs, 20); // M√°ximo 20 para visualizaci√≥n
                
                let rabbitsHTML = '';
                for (let j = 0; j < displayPairs; j++) {
                    // Alternar entre parejas maduras (‚ù§Ô∏èüê∞üê∞) y j√≥venes (üíõüê∞üê∞)
                    const isMature = j < fibSequence[Math.max(0, i-1)];
                    rabbitsHTML += `<div class="rabbit-pair">${isMature ? '‚ù§Ô∏è' : 'üíõ'}üê∞üê∞</div>`;
                }
                
                if (pairs > 20) {
                    rabbitsHTML += '<div class="rabbit-pair">...</div>';
                }
                
                monthDiv.innerHTML = `
                    <div class="rabbit-info">Mes ${i + 1}</div>
                    <div class="rabbit-display">${rabbitsHTML}</div>
                    <div class="fib-highlight">F(${i + 1}) = ${pairs}</div>
                `;
                container.appendChild(monthDiv);
            }
        }

        function animateRabbits() {
            const months = document.querySelectorAll('.rabbit-month');
            months.forEach((month, index) => {
                month.style.transform = 'scale(0.8)';
                month.style.opacity = '0.5';
                setTimeout(() => {
                    month.style.transform = 'scale(1.1)';
                    month.style.opacity = '1';
                    month.style.background = 'linear-gradient(135deg, rgba(255, 107, 107, 0.4), rgba(78, 205, 196, 0.4))';
                    setTimeout(() => {
                        month.style.transform = 'scale(1)';
                        month.style.background = 'linear-gradient(135deg, rgba(78, 205, 196, 0.2), rgba(69, 183, 209, 0.2))';
                    }, 500);
                }, index * 150);
            });
        }

        function resetRabbitAnimation() {
            const months = document.querySelectorAll('.rabbit-month');
            months.forEach(month => {
                month.style.transform = 'scale(1)';
                month.style.opacity = '1';
                month.style.background = 'linear-gradient(135deg, rgba(78, 205, 196, 0.2), rgba(69, 183, 209, 0.2))';
            });
        }

        // Modal de colores
        function openColorModal() {
            document.getElementById('colorModal').style.display = 'block';
        }

        function closeColorModal() {
            document.getElementById('colorModal').style.display = 'none';
        }

        function applyColors() {
            currentColors.line = document.getElementById('lineColor').value;
            currentColors.point = document.getElementById('pointColor').value;
            currentColors.centerSeed = document.getElementById('centerSeedColor').value;
            currentColors.outerSeed = document.getElementById('outerSeedColor').value;
            currentColors.square = document.getElementById('squareColor').value;
            currentColors.spiral = document.getElementById('spiralColor').value;
            
            // Actualizar visualizaciones
            createChart();
            createSunflower();
            drawFibonacciSpiral();
            closeColorModal();
        }

        function resetColors() {
            currentColors = {
                line: '#FF6B6B',
                point: '#4ECDC4',
                centerSeed: '#000000',
                outerSeed: '#FFFFFF',
                square: '#FF6B6B',
                spiral: '#FFD700'
            };
            document.getElementById('lineColor').value = currentColors.line;
            document.getElementById('pointColor').value = currentColors.point;
            document.getElementById('centerSeedColor').value = currentColors.centerSeed;
            document.getElementById('outerSeedColor').value = currentColors.outerSeed;
            document.getElementById('squareColor').value = currentColors.square;
            document.getElementById('spiralColor').value = currentColors.spiral;
        }

        // Gr√°fico mejorado con Plotly
        async function createChart() {
            if (!plotlyLoaded) await waitForPlotly();
            
            const n = parseInt(document.getElementById('termsSlider').value);
            const sequence = [];
            const labels = [];
            
            for (let i = 0; i < n; i++) {
                sequence.push(fibonacciOptimized(i));
                labels.push(`F(${i})`);
            }

            const trace1 = {
                x: labels,
                y: sequence,
                type: 'scatter',
                mode: 'lines+markers',
                line: {
                    color: currentColors.line,
                    width: 4,
                    shape: 'spline'
                },
                marker: {
                    color: currentColors.point,
                    size: 12,
                    line: {
                        color: 'white',
                        width: 2
                    }
                },
                name: 'Fibonacci',
                text: sequence.map(val => `Valor: ${val}`),
                textposition: 'top center'
            };

            const layout = {
                title: {
                    text: 'Crecimiento Exponencial de Fibonacci',
                    font: {
                        color: '#2c3e50',
                        size: 24,
                        family: 'Segoe UI'
                    }
                },
                xaxis: {
                    title: 'Posici√≥n en la Secuencia',
                    titlefont: { color: '#2c3e50', size: 16 },
                    tickfont: { color: '#2c3e50' },
                    gridcolor: 'rgba(0,0,0,0.1)',
                    zerolinecolor: 'rgba(0,0,0,0.2)'
                },
                yaxis: {
                    title: 'Valor Fibonacci',
                    titlefont: { color: '#2c3e50', size: 16 },
                    tickfont: { color: '#2c3e50' },
                    gridcolor: 'rgba(0,0,0,0.1)',
                    zerolinecolor: 'rgba(0,0,0,0.2)'
                },
                plot_bgcolor: 'white',
                paper_bgcolor: 'white',
                font: { color: '#2c3e50' },
                showlegend: false
            };

            try {
                Plotly.newPlot('fibonacciChart', [trace1], layout, {responsive: true, displayModeBar: false});
            } catch (error) {
                console.log('Error creando gr√°fico:', error);
            }
        }

        function updateChart() {
            createChart();
        }

        // Espiral de Fibonacci CORREGIDA - Rect√°ngulos √°ureos y espiral de Durero
        async function drawFibonacciSpiral() {
            if (!plotlyLoaded) await waitForPlotly();
            
            const fibs = [1, 1, 2, 3, 5, 8, 13, 21];
            const traces = [];
            const phi = (1 + Math.sqrt(5)) / 2;
            
            // Construir rect√°ngulos √°ureos paso a paso
            let currentX = 0;
            let currentY = 0;
            let currentWidth = fibs[0];
            let currentHeight = fibs[1];
            
            const rectangles = [];
            const spiralPoints = { x: [], y: [] };
            
            // Primer rect√°ngulo (1x1)
            rectangles.push({
                x: [0, 1, 1, 0, 0],
                y: [0, 0, 1, 1, 0],
                width: 1,
                height: 1,
                centerX: 0.5,
                centerY: 0.5,
                fibIndex: 0
            });
            
            // Segundo rect√°ngulo (1x1) - al lado del primero
            rectangles.push({
                x: [1, 2, 2, 1, 1],
                y: [0, 0, 1, 1, 0],
                width: 1,
                height: 1,
                centerX: 1.5,
                centerY: 0.5,
                fibIndex: 1
            });
            
            // Construir rect√°ngulos √°ureos sucesivos
            let direction = 0; // 0: arriba, 1: izquierda, 2: abajo, 3: derecha
            let minX = 0, maxX = 2, minY = 0, maxY = 1;
            
            for (let i = 2; i < fibs.length; i++) {
                const size = fibs[i];
                let newRect = { fibIndex: i, width: size, height: size };
                
                switch (direction % 4) {
                    case 0: // Agregar arriba
                        newRect.x = [minX, maxX, maxX, minX, minX];
                        newRect.y = [maxY, maxY, maxY + size, maxY + size, maxY];
                        newRect.centerX = (minX + maxX) / 2;
                        newRect.centerY = maxY + size / 2;
                        maxY += size;
                        break;
                    case 1: // Agregar a la izquierda
                        newRect.x = [minX - size, minX, minX, minX - size, minX - size];
                        newRect.y = [minY, minY, maxY, maxY, minY];
                        newRect.centerX = minX - size / 2;
                        newRect.centerY = (minY + maxY) / 2;
                        minX -= size;
                        break;
                    case 2: // Agregar abajo
                        newRect.x = [minX, maxX, maxX, minX, minX];
                        newRect.y = [minY - size, minY - size, minY, minY, minY - size];
                        newRect.centerX = (minX + maxX) / 2;
                        newRect.centerY = minY - size / 2;
                        minY -= size;
                        break;
                    case 3: // Agregar a la derecha
                        newRect.x = [maxX, maxX + size, maxX + size, maxX, maxX];
                        newRect.y = [minY, minY, maxY, maxY, minY];
                        newRect.centerX = maxX + size / 2;
                        newRect.centerY = (minY + maxY) / 2;
                        maxX += size;
                        break;
                }
                
                rectangles.push(newRect);
                direction++;
            }
            
            // Dibujar rect√°ngulos con colores diferenciados
            rectangles.forEach((rect, index) => {
                const hue = (index * 50) % 360;
                traces.push({
                    x: rect.x,
                    y: rect.y,
                    mode: 'lines',
                    line: { 
                        color: `hsl(${hue}, 70%, 50%)`, 
                        width: 3 
                    },
                    fill: 'none',
                    showlegend: false,
                    name: `Rect√°ngulo F(${rect.fibIndex + 1}) = ${fibs[rect.fibIndex]}`
                });
                
                // Etiqueta con el n√∫mero de Fibonacci
                traces.push({
                    x: [rect.centerX],
                    y: [rect.centerY],
                    mode: 'text',
                    text: [fibs[rect.fibIndex].toString()],
                    textfont: { 
                        size: Math.min(16, Math.max(8, rect.width)), 
                        color: 'black', 
                        family: 'Arial Black' 
                    },
                    showlegend: false
                });
            });
            
            // Crear la espiral dorada (cuartos de c√≠rculo en cada rect√°ngulo)
            rectangles.forEach((rect, index) => {
                if (index < 2) return; // Saltar los dos primeros cuadrados unitarios
                
                const size = fibs[rect.fibIndex];
                const spiralX = [];
                const spiralY = [];
                
                // Determinar el centro del arco seg√∫n la direcci√≥n
                let centerX, centerY, startAngle, endAngle;
                const direction = index % 4;
                
                switch (direction) {
                    case 0: // Arriba
                        centerX = rect.x[0];
                        centerY = rect.y[0];
                        startAngle = 0;
                        endAngle = Math.PI / 2;
                        break;
                    case 1: // Izquierda  
                        centerX = rect.x[1];
                        centerY = rect.y[1];
                        startAngle = Math.PI / 2;
                        endAngle = Math.PI;
                        break;
                    case 2: // Abajo
                        centerX = rect.x[2];
                        centerY = rect.y[2];
                        startAngle = Math.PI;
                        endAngle = 3 * Math.PI / 2;
                        break;
                    case 3: // Derecha
                        centerX = rect.x[3];
                        centerY = rect.y[3];
                        startAngle = 3 * Math.PI / 2;
                        endAngle = 2 * Math.PI;
                        break;
                }
                
                // Generar puntos del arco
                for (let angle = startAngle; angle <= endAngle; angle += 0.05) {
                    spiralX.push(centerX + size * Math.cos(angle));
                    spiralY.push(centerY + size * Math.sin(angle));
                }
                
                if (spiralX.length > 0) {
                    traces.push({
                        x: spiralX,
                        y: spiralY,
                        mode: 'lines',
                        line: { 
                            color: currentColors.spiral, 
                            width: 4 
                        },
                        showlegend: false,
                        name: `Arco F(${rect.fibIndex + 1})`
                    });
                }
            });
            
            // Informaci√≥n adicional
            traces.push({
                x: [maxX + 2],
                y: [maxY - 2],
                mode: 'text',
                text: [`üìê Rect√°ngulo √Åureo\nAncho:Alto = œÜ:1\nœÜ = ${phi.toFixed(3)}...`],
                textfont: { size: 12, color: '#2c3e50', family: 'Arial' },
                showlegend: false
            });
            
            const layout = {
                title: {
                    text: 'üåÄ Espiral de Fibonacci - Rect√°ngulos √Åureos + Espiral de Durero',
                    font: { color: '#2c3e50', size: 20 }
                },
                xaxis: {
                    title: 'X',
                    titlefont: { color: '#2c3e50' },
                    tickfont: { color: '#2c3e50' },
                    gridcolor: 'rgba(0,0,0,0.1)',
                    scaleanchor: 'y',
                    scaleratio: 1,
                    showgrid: true
                },
                yaxis: {
                    title: 'Y',
                    titlefont: { color: '#2c3e50' },
                    tickfont: { color: '#2c3e50' },
                    gridcolor: 'rgba(0,0,0,0.1)',
                    showgrid: true
                },
                plot_bgcolor: 'white',
                paper_bgcolor: 'white',
                font: { color: '#2c3e50' }
            };
            
            try {
                Plotly.newPlot('fibonacciSpiral', traces, layout, {responsive: true, displayModeBar: false});
            } catch (error) {
                console.log('Error creando espiral:', error);
            }
        }

        function animateSpiral() {
            drawFibonacciSpiral();
        }

        // Girasol MEJORADO - La simulaci√≥n estrella con widgets avanzados
        async function createSunflower() {
            if (!plotlyLoaded) await waitForPlotly();
            
            const numSeeds = parseInt(document.getElementById('seedSlider').value);
            document.getElementById('seedCount').textContent = numSeeds;
            
            const phi = (1 + Math.sqrt(5)) / 2;
            const goldenAngle = 2 * Math.PI / (phi * phi); // 137.508¬∞ en radianes
            
            const seeds = [];
            const traces = [];
            
            // Generar las semillas con mayor tama√±o
            for (let i = 0; i < numSeeds; i++) {
                const r = Math.sqrt(i) * 3.2; // Mayor espaciado
                const theta = i * goldenAngle;
                const x = r * Math.cos(theta);
                const y = r * Math.sin(theta);
                
                // Patr√≥n m√°s realista de semillas
                const isBlack = (i % 2 === 0) || (r < 25);
                
                seeds.push({
                    x: x,
                    y: y,
                    size: Math.max(4, 15 - r/10), // Semillas m√°s grandes
                    color: isBlack ? currentColors.centerSeed : currentColors.outerSeed,
                    index: i,
                    r: r,
                    theta: theta
                });
            }
            
            // Agregar las semillas
            traces.push({
                x: seeds.map(s => s.x),
                y: seeds.map(s => s.y),
                mode: 'markers',
                marker: {
                    size: seeds.map(s => s.size),
                    color: seeds.map(s => s.color),
                    line: { color: 'rgb(101, 67, 33)', width: 1 }
                },
                showlegend: false,
                name: 'Semillas'
            });
            
            // Determinar n√∫meros de espirales seg√∫n cantidad de semillas
            let clockwiseCount, counterclockwiseCount;
            if (numSeeds < 150) {
                clockwiseCount = 8; counterclockwiseCount = 13;
            } else if (numSeeds < 250) {
                clockwiseCount = 13; counterclockwiseCount = 21;
            } else if (numSeeds < 450) {
                clockwiseCount = 21; counterclockwiseCount = 34;
            } else if (numSeeds < 650) {
                clockwiseCount = 34; counterclockwiseCount = 55;
            } else {
                clockwiseCount = 55; counterclockwiseCount = 89;
            }
            
            // Actualizar widgets
            document.getElementById('clockwiseCount').textContent = clockwiseCount;
            document.getElementById('counterclockwiseCount').textContent = counterclockwiseCount;
            const ratio = (counterclockwiseCount / clockwiseCount).toFixed(3);
            document.getElementById('fibonacciRatio').textContent = `${counterclockwiseCount}/${clockwiseCount} = ${ratio}`;
            
            // Funci√≥n mejorada para dibujar espirales
            function drawSpirals() {
                const showClockwise = document.getElementById('showSpiralsClockwise').checked;
                const showCounterclockwise = document.getElementById('showSpiralsCounterclockwise').checked;
                
                // Espirales en sentido horario (rojas)
                if (showClockwise) {
                    for (let spiral = 0; spiral < clockwiseCount; spiral++) {
                        const spiralSeeds = [];
                        
                        // Algoritmo mejorado para seguir espirales
                        for (let i = spiral; i < numSeeds; i += clockwiseCount) {
                            if (seeds[i] && seeds[i].r > 8 && seeds[i].r < 80) {
                                spiralSeeds.push(seeds[i]);
                            }
                        }
                        
                        if (spiralSeeds.length > 2) {
                            spiralSeeds.sort((a, b) => a.r - b.r);
                            
                            traces.push({
                                x: spiralSeeds.map(s => s.x),
                                y: spiralSeeds.map(s => s.y),
                                mode: 'lines',
                                line: { 
                                    color: `rgba(255, 0, 0, 0.7)`, 
                                    width: 3 
                                },
                                showlegend: false,
                                name: `Espiral horaria ${spiral + 1}`
                            });
                        }
                    }
                }
                
                // Espirales en sentido antihorario (azules)
                if (showCounterclockwise) {
                    for (let spiral = 0; spiral < counterclockwiseCount; spiral++) {
                        const spiralSeeds = [];
                        
                        for (let i = spiral; i < numSeeds; i += counterclockwiseCount) {
                            if (seeds[i] && seeds[i].r > 8 && seeds[i].r < 80) {
                                spiralSeeds.push(seeds[i]);
                            }
                        }
                        
                        if (spiralSeeds.length > 2) {
                            spiralSeeds.sort((a, b) => a.r - b.r);
                            
                            traces.push({
                                x: spiralSeeds.map(s => s.x),
                                y: spiralSeeds.map(s => s.y),
                                mode: 'lines',
                                line: { 
                                    color: `rgba(0, 0, 255, 0.7)`, 
                                    width: 3 
                                },
                                showlegend: false,
                                name: `Espiral antihoraria ${spiral + 1}`
                            });
                        }
                    }
                }
                
                // Etiquetas informativas m√°s elegantes
                if (showClockwise) {
                    traces.push({
                        x: [60],
                        y: [70],
                        mode: 'text',
                        text: [`üî¥ ${clockwiseCount} espirales ‚û°Ô∏è`],
                        textfont: { size: 18, color: 'red', family: 'Arial Black' },
                        showlegend: false
                    });
                }
                
                if (showCounterclockwise) {
                    traces.push({
                        x: [60],
                        y: [55],
                        mode: 'text',
                        text: [`üîµ ${counterclockwiseCount} espirales ‚¨ÖÔ∏è`],
                        textfont: { size: 18, color: 'blue', family: 'Arial Black' },
                        showlegend: false
                    });
                }
                
                // Informaci√≥n del √°ngulo dorado
                traces.push({
                    x: [60],
                    y: [40],
                    mode: 'text',
                    text: [`‚ú® √Ångulo: 137.5¬∞ (dorado)`],
                    textfont: { size: 16, color: '#2c3e50', family: 'Arial' },
                    showlegend: false
                });
                
                traces.push({
                    x: [60],
                    y: [25],
                    mode: 'text',
                    text: [`üåü Proporci√≥n: ${ratio} ‚âà œÜ`],
                    textfont: { size: 16, color: '#FF6B6B', family: 'Arial' },
                    showlegend: false
                });
            }
            
            drawSpirals();
            
            const layout = {
                title: {
                    text: `üåª Girasol Fibonacci con ${numSeeds} semillas - ¬°Magia matem√°tica pura!`,
                    font: { color: '#2c3e50', size: 20 }
                },
                xaxis: {
                    showgrid: false,
                    zeroline: false,
                    showticklabels: false,
                    range: [-90, 90] // Rango m√°s grande
                },
                yaxis: {
                    showgrid: false,
                    zeroline: false,
                    showticklabels: false,
                    range: [-90, 90], // Rango m√°s grande
                    scaleanchor: 'x',
                    scaleratio: 1
                },
                plot_bgcolor: '#FFEAA7',
                paper_bgcolor: '#FFEAA7',
                margin: { t: 60, b: 20, l: 20, r: 20 }
            };
            
            try {
                Plotly.newPlot('sunflowerPattern', traces, layout, {responsive: true, displayModeBar: false});
            } catch (error) {
                console.log('Error creando girasol:', error);
            }
        }

        // Crear flores con n√∫meros EXACTOS de p√©talos y COLORES DIFERENCIADOS
        async function createFlower(petals, containerId, color1, color2) {
            if (!plotlyLoaded) await waitForPlotly();
            
            const petalTraces = [];
            
            // Generar colores √∫nicos para cada p√©talo
            const generatePetalColor = (index, total) => {
                const hue = (index * 360 / total) % 360;
                return `hsla(${hue}, 70%, 60%, 0.8)`;
            };
            
            const generatePetalBorderColor = (index, total) => {
                const hue = (index * 360 / total) % 360;
                return `hsla(${hue}, 80%, 40%, 1)`;
            };
            
            // Crear exactamente el n√∫mero especificado de p√©talos
            for (let i = 0; i < petals; i++) {
                const angle = (i * 2 * Math.PI) / petals;
                const petalX = [];
                const petalY = [];
                
                // Forma de p√©talo individual - usando par√°metros que crean UNA forma cerrada
                const steps = 50;
                for (let j = 0; j <= steps; j++) {
                    const t = (j / steps) * 2 * Math.PI;
                    // Ecuaci√≥n polar mejorada para forma de p√©talo realista
                    const r = 0.9 * (1 + 0.3 * Math.cos(3 * t)) * Math.exp(-0.08 * t);
                    const x = r * Math.cos(t + angle);
                    const y = r * Math.sin(t + angle);
                    petalX.push(x);
                    petalY.push(y);
                }
                
                // Cerrar el p√©talo conectando con el primer punto
                petalX.push(petalX[0]);
                petalY.push(petalY[0]);
                
                petalTraces.push({
                    x: petalX,
                    y: petalY,
                    fill: 'toself',
                    fillcolor: generatePetalColor(i, petals),
                    line: { 
                        color: generatePetalBorderColor(i, petals), 
                        width: 3 
                    },
                    showlegend: false,
                    name: `P√©talo ${i + 1} de ${petals}`,
                    text: `P√©talo ${i + 1}`,
                    hoverinfo: 'text'
                });
            }
            
            // Centro de la flor m√°s prominente
            const center = {
                x: [0],
                y: [0],
                mode: 'markers',
                marker: { 
                    size: 30, 
                    color: '#FFD700', 
                    line: { color: '#FFA500', width: 4 },
                    symbol: 'circle'
                },
                showlegend: false,
                name: 'Centro'
            };
            
            // Agregar n√∫mero de p√©talos como texto
            const petalCounter = {
                x: [0],
                y: [0],
                mode: 'text',
                text: [petals.toString()],
                textfont: { 
                    size: 16, 
                    color: '#000', 
                    family: 'Arial Black' 
                },
                showlegend: false
            };
            
            const layout = {
                title: {
                    text: `F(${Math.log2(petals) + 1 || 'n'}) = ${petals} p√©talos exactos`,
                    font: { color: '#2c3e50', size: 16, family: 'Arial' }
                },
                xaxis: {
                    showgrid: false,
                    zeroline: false,
                    showticklabels: false,
                    range: [-1.2, 1.2]
                },
                yaxis: {
                    showgrid: false,
                    zeroline: false,
                    showticklabels: false,
                    range: [-1.2, 1.2],
                    scaleanchor: 'x',
                    scaleratio: 1
                },
                plot_bgcolor: 'rgba(255,255,255,0)',
                paper_bgcolor: 'rgba(255,255,255,0)',
                margin: { t: 40, b: 20, l: 20, r: 20 }
            };
            
            try {
                Plotly.newPlot(containerId, [...petalTraces, center, petalCounter], layout, {responsive: true, displayModeBar: false});
            } catch (error) {
                console.log('Error creando flor:', error);
            }
        }

        async function createAllFlowers() {
            await createFlower(3, 'flower3', 'rgba(147, 112, 219, 0.7)', 'rgb(147, 112, 219)');
            await createFlower(5, 'flower5', 'rgba(255, 105, 180, 0.7)', 'rgb(255, 105, 180)');
            await createFlower(8, 'flower8', 'rgba(255, 140, 0, 0.7)', 'rgb(255, 140, 0)');
            await createFlower(13, 'flower13', 'rgba(50, 205, 50, 0.7)', 'rgb(50, 205, 50)');
        }

        function animateFlowers() {
            createAllFlowers();
        }

        // √Årbol fractal MEJORADO con ramas coloreadas y numeradas
        function createTree() {
            const canvas = document.getElementById('treeCanvas');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            const level = parseInt(document.getElementById('treeLevel').value);
            const fibValue = fibonacciOptimized(level);
            
            // Actualizar informaci√≥n
            document.getElementById('treeLevelText').textContent = level;
            document.getElementById('currentTreeLevel').textContent = level;
            document.getElementById('branchCount').textContent = fibValue;
            document.getElementById('fibIndex').textContent = level;
            document.getElementById('fibValue').textContent = fibValue;
            
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            let branchCounter = 0;
            const branchColors = [
                '#8B4513', '#A0522D', '#CD853F', '#D2691E', '#DEB887',
                '#F4A460', '#BC8F8F', '#D2B48C'
            ];
            
            function drawBranch(x, y, length, angle, depth, parentBranch = 0) {
                if (depth === 0) return;
                
                branchCounter++;
                const currentBranch = branchCounter;
                
                const endX = x + length * Math.cos(angle);
                const endY = y + length * Math.sin(angle);
                
                // Color seg√∫n profundidad y posici√≥n
                const colorIndex = (depth - 1) % branchColors.length;
                ctx.strokeStyle = branchColors[colorIndex];
                ctx.lineWidth = depth * 3;
                
                // Dibujar rama
                ctx.beginPath();
                ctx.moveTo(x, y);
                ctx.lineTo(endX, endY);
                ctx.stroke();
                
                // Etiqueta numerada para cada rama
                ctx.fillStyle = '#FFFFFF';
                ctx.fillRect(endX - 12, endY - 12, 24, 24);
                ctx.strokeStyle = '#000000';
                ctx.lineWidth = 1;
                ctx.strokeRect(endX - 12, endY - 12, 24, 24);
                
                ctx.fillStyle = '#000000';
                ctx.font = 'bold 12px Arial';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText(currentBranch.toString(), endX, endY);
                
                if (depth > 1) {
                    const newLength = length * 0.75;
                    const branches = Math.min(fibonacciOptimized(depth), 4);
                    
                    // Calcular √°ngulos para distribuir ramas uniformemente
                    const angleSpread = Math.PI / 3; // 60 grados de separaci√≥n
                    const startAngle = angle - angleSpread / 2;
                    
                    for (let i = 0; i < branches; i++) {
                        const branchAngle = startAngle + (i * angleSpread / (branches - 1));
                        
                        setTimeout(() => {
                            drawBranch(endX, endY, newLength, branchAngle, depth - 1, currentBranch);
                        }, (8 - depth) * 200);
                    }
                }
            }
            
            // Dibujar tronco principal
            ctx.strokeStyle = '#654321';
            ctx.lineWidth = level * 3;
            ctx.beginPath();
            ctx.moveTo(350, 500);
            ctx.lineTo(350, 450);
            ctx.stroke();
            
            // Etiqueta del tronco
            ctx.fillStyle = '#FFFFFF';
            ctx.fillRect(338, 463, 24, 24);
            ctx.strokeStyle = '#000000';
            ctx.lineWidth = 1;
            ctx.strokeRect(338, 463, 24, 24);
            ctx.fillStyle = '#000000';
            ctx.font = 'bold 12px Arial';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText('T', 350, 475);
            
            // Comenzar ramificaci√≥n
            setTimeout(() => {
                drawBranch(350, 450, 80, -Math.PI/2, level);
            }, 500);
            
            // Mostrar informaci√≥n del patr√≥n
            ctx.fillStyle = 'rgba(255, 255, 255, 0.9)';
            ctx.fillRect(20, 20, 300, 120);
            ctx.strokeStyle = '#000000';
            ctx.lineWidth = 2;
            ctx.strokeRect(20, 20, 300, 120);
            
            ctx.fillStyle = '#000000';
            ctx.font = 'bold 14px Arial';
            ctx.textAlign = 'left';
            ctx.fillText(`üå≤ √Årbol de Fibonacci - Nivel ${level}`, 30, 40);
            ctx.font = '12px Arial';
            ctx.fillText(`üìä Patr√≥n: F(${level}) = ${fibValue} ramas por nivel`, 30, 60);
            ctx.fillText(`üéØ Total esperado: ~${Math.pow(fibValue, level)} ramas`, 30, 80);
            ctx.fillText(`üè∑Ô∏è T = Tronco, n√∫meros = orden de crecimiento`, 30, 100);
            ctx.fillText(`üé® Colores = diferentes niveles de profundidad`, 30, 120);
        }

        // Mariposa ULTRA REALISTA redise√±ada
        async function createButterfly() {
            if (!plotlyLoaded) await waitForPlotly();
            
            const phi = (1 + Math.sqrt(5)) / 2;
            const traces = [];
            
            // Funci√≥n para crear alas realistas con forma de mariposa
            function createButterflyWing(isRight = true, isUpper = true) {
                const sign = isRight ? 1 : -1;
                const wingData = [];
                
                if (isUpper) {
                    // Ala superior - forma caracter√≠stica de mariposa
                    const points = [
                        {x: 0, y: 0.2},
                        {x: sign * 0.5, y: 0.8},
                        {x: sign * 1.2, y: 1.5},
                        {x: sign * 1.8, y: 1.8},
                        {x: sign * 2.2, y: 1.6},
                        {x: sign * 2.0, y: 1.0},
                        {x: sign * 1.5, y: 0.5},
                        {x: sign * 0.8, y: 0.2},
                        {x: 0, y: 0.2}
                    ];
                    return points;
                } else {
                    // Ala inferior - m√°s peque√±a y redondeada
                    const points = [
                        {x: 0, y: 0.2},
                        {x: sign * 0.3, y: 0.1},
                        {x: sign * 0.8, y: -0.2},
                        {x: sign * 1.2, y: -0.5},
                        {x: sign * 1.0, y: -0.8},
                        {x: sign * 0.6, y: -0.6},
                        {x: sign * 0.2, y: -0.2},
                        {x: 0, y: 0.2}
                    ];
                    return points;
                }
            }
            
            // Crear las 4 alas con formas realistas
            const upperRightWing = createButterflyWing(true, true);
            const upperLeftWing = createButterflyWing(false, true);
            const lowerRightWing = createButterflyWing(true, false);
            const lowerLeftWing = createButterflyWing(false, false);
            
            // Ala superior derecha - Azul a p√∫rpura
            traces.push({
                x: upperRightWing.map(p => p.x),
                y: upperRightWing.map(p => p.y),
                fill: 'toself',
                fillcolor: 'rgba(75, 0, 130, 0.8)',
                line: { color: 'rgb(50, 0, 100)', width: 3 },
                showlegend: false
            });
            
            // Ala superior izquierda - Azul a p√∫rpura (espejo)
            traces.push({
                x: upperLeftWing.map(p => p.x),
                y: upperLeftWing.map(p => p.y),
                fill: 'toself',
                fillcolor: 'rgba(75, 0, 130, 0.8)',
                line: { color: 'rgb(50, 0, 100)', width: 3 },
                showlegend: false
            });
            
            // Ala inferior derecha - Naranja a rojo
            traces.push({
                x: lowerRightWing.map(p => p.x),
                y: lowerRightWing.map(p => p.y),
                fill: 'toself',
                fillcolor: 'rgba(255, 69, 0, 0.8)',
                line: { color: 'rgb(200, 50, 0)', width: 3 },
                showlegend: false
            });
            
            // Ala inferior izquierda - Naranja a rojo (espejo)
            traces.push({
                x: lowerLeftWing.map(p => p.x),
                y: lowerLeftWing.map(p => p.y),
                fill: 'toself',
                fillcolor: 'rgba(255, 69, 0, 0.8)',
                line: { color: 'rgb(200, 50, 0)', width: 3 },
                showlegend: false
            });
            
            // Patrones realistas en las alas - puntos y manchas
            const eyeSpots = [
                // "Ojos" en las alas superiores
                { x: 1.5, y: 1.2, size: 20, color: 'rgba(255, 255, 255, 0.9)' },
                { x: -1.5, y: 1.2, size: 20, color: 'rgba(255, 255, 255, 0.9)' },
                { x: 1.5, y: 1.2, size: 12, color: 'rgba(0, 0, 0, 0.8)' },
                { x: -1.5, y: 1.2, size: 12, color: 'rgba(0, 0, 0, 0.8)' },
                { x: 1.5, y: 1.2, size: 6, color: 'rgba(255, 255, 255, 1)' },
                { x: -1.5, y: 1.2, size: 6, color: 'rgba(255, 255, 255, 1)' },
                
                // Manchas en alas inferiores
                { x: 0.8, y: -0.3, size: 12, color: 'rgba(255, 255, 0, 0.8)' },
                { x: -0.8, y: -0.3, size: 12, color: 'rgba(255, 255, 0, 0.8)' },
                { x: 0.8, y: -0.3, size: 6, color: 'rgba(255, 140, 0, 0.9)' },
                { x: -0.8, y: -0.3, size: 6, color: 'rgba(255, 140, 0, 0.9)' },
                
                // Puntos decorativos
                { x: 1.0, y: 0.8, size: 8, color: 'rgba(255, 255, 255, 0.7)' },
                { x: -1.0, y: 0.8, size: 8, color: 'rgba(255, 255, 255, 0.7)' },
                { x: 1.8, y: 1.4, size: 6, color: 'rgba(255, 215, 0, 0.8)' },
                { x: -1.8, y: 1.4, size: 6, color: 'rgba(255, 215, 0, 0.8)' }
            ];
            
            eyeSpots.forEach(spot => {
                traces.push({
                    x: [spot.x],
                    y: [spot.y],
                    mode: 'markers',
                    marker: { 
                        size: spot.size, 
                        color: spot.color,
                        line: { color: 'rgba(0,0,0,0.3)', width: 1 }
                    },
                    showlegend: false
                });
            });
            
            // Cuerpo de mariposa realista - m√°s grueso arriba, delgado abajo
            const bodyY = [-1.0, -0.5, 0, 0.5, 1.0, 1.5, 2.0];
            const bodyWidth = [3, 4, 5, 6, 5, 4, 3];
            
            bodyY.forEach((y, i) => {
                traces.push({
                    x: [0],
                    y: [y],
                    mode: 'markers',
                    marker: { 
                        size: bodyWidth[i], 
                        color: 'rgb(101, 67, 33)',
                        line: { color: 'rgb(139, 69, 19)', width: 1 }
                    },
                    showlegend: false
                });
            });
            
            // Cabeza de la mariposa
            traces.push({
                x: [0],
                y: [2.2],
                mode: 'markers',
                marker: { size: 15, color: 'rgb(101, 67, 33)' },
                showlegend: false
            });
            
            // Ojos compuestos
            traces.push({
                x: [-0.1, 0.1],
                y: [2.3, 2.3],
                mode: 'markers',
                marker: { size: 6, color: 'rgb(0, 0, 0)' },
                showlegend: false
            });
            
            // Antenas realistas - curvas naturales
            const leftAntenna = [], rightAntenna = [];
            for (let t = 0; t <= 1; t += 0.1) {
                leftAntenna.push({ 
                    x: -0.2 - 0.3 * t, 
                    y: 2.2 + 0.4 * t - 0.15 * t * t 
                });
                rightAntenna.push({ 
                    x: 0.2 + 0.3 * t, 
                    y: 2.2 + 0.4 * t - 0.15 * t * t 
                });
            }
            
            traces.push({
                x: leftAntenna.map(p => p.x),
                y: leftAntenna.map(p => p.y),
                mode: 'lines',
                line: { color: 'rgb(101, 67, 33)', width: 3 },
                showlegend: false
            });
            
            traces.push({
                x: rightAntenna.map(p => p.x),
                y: rightAntenna.map(p => p.y),
                mode: 'lines',
                line: { color: 'rgb(101, 67, 33)', width: 3 },
                showlegend: false
            });
            
            // Puntas de las antenas (mazas)
            traces.push({
                x: [-0.5, 0.5],
                y: [2.45, 2.45],
                mode: 'markers',
                marker: { size: 8, color: 'rgb(139, 69, 19)' },
                showlegend: false
            });
            
            const layout = {
                title: {
                    text: 'Mariposa Monarca con Proporciones √Åureas œÜ = 1.618',
                    font: { color: '#2c3e50', size: 18 }
                },
                xaxis: {
                    showgrid: false,
                    zeroline: false,
                    showticklabels: false,
                    range: [-3, 3]
                },
                yaxis: {
                    showgrid: false,
                    zeroline: false,
                    showticklabels: false,
                    range: [-1.5, 3],
                    scaleanchor: 'x',
                    scaleratio: 1
                },
                plot_bgcolor: 'rgba(255,255,255,0)',
                paper_bgcolor: 'rgba(255,255,255,0)',
                margin: { t: 50, b: 20, l: 20, r: 20 }
            };
            
            try {
                Plotly.newPlot('butterflyWings', traces, layout, {responsive: true, displayModeBar: false});
            } catch (error) {
                console.log('Error creando mariposa:', error);
            }
        }

        // Funci√≥n para mostrar las medidas de Fibonacci en la mariposa
        async function showButterflyFibonacci() {
            await createButterfly(); // Primero crear la mariposa b√°sica
            
            if (!plotlyLoaded) return;
            
            // L√≠neas de medici√≥n de Fibonacci
            const fibonacciLines = [];
            const phi = (1 + Math.sqrt(5)) / 2;
            
            // L√≠nea horizontal que muestra la proporci√≥n √°urea entre alas
            fibonacciLines.push({
                x: [-2.2, 2.2],
                y: [1.8, 1.8],
                mode: 'lines',
                line: { color: 'yellow', width: 4, dash: 'dash' },
                showlegend: false,
                name: 'Ancho total'
            });
            
            // L√≠nea vertical que muestra la altura total
            fibonacciLines.push({
                x: [0, 0],
                y: [-1.5, 1.8],
                mode: 'lines',
                line: { color: 'yellow', width: 4, dash: 'dash' },
                showlegend: false,
                name: 'Altura total'
            });
            
            // L√≠neas que muestran las secciones √°ureas
            fibonacciLines.push({
                x: [-1.36, 1.36], // 2.2/œÜ = 1.36
                y: [1.6, 1.6],
                mode: 'lines',
                line: { color: 'lime', width: 3 },
                showlegend: false,
                name: 'Secci√≥n √°urea'
            });
            
            // Etiquetas de medidas
            const measurements = [
                { x: 0, y: 2.1, text: 'üìè Ancho total = œÜ √ó altura', size: 14, color: 'yellow' },
                { x: 0, y: -1.8, text: 'üìê Ala superior : ala inferior = œÜ', size: 14, color: 'lime' },
                { x: 2.5, y: 0, text: 'üåü œÜ = 1.618...', size: 16, color: 'gold' },
                { x: -2.5, y: 0, text: '‚ú® Fibonacci!', size: 16, color: 'gold' }
            ];
            
            measurements.forEach(m => {
                fibonacciLines.push({
                    x: [m.x],
                    y: [m.y],
                    mode: 'text',
                    text: [m.text],
                    textfont: { size: m.size, color: m.color, family: 'Arial Black' },
                    showlegend: false
                });
            });
            
            // Obtener el gr√°fico actual y a√±adir las l√≠neas
            const currentData = document.getElementById('butterflyWings').data || [];
            const allTraces = [...currentData, ...fibonacciLines];
            
            const layout = {
                title: {
                    text: 'ü¶ã Mariposa con Medidas de Fibonacci Visibles',
                    font: { color: '#2c3e50', size: 18 }
                },
                xaxis: {
                    showgrid: false,
                    zeroline: false,
                    showticklabels: false,
                    range: [-3.5, 3.5]
                },
                yaxis: {
                    showgrid: false,
                    zeroline: false,
                    showticklabels: false,
                    range: [-2.5, 2.5],
                    scaleanchor: 'x',
                    scaleratio: 1
                },
                plot_bgcolor: 'rgba(255,255,255,0)',
                paper_bgcolor: 'rgba(255,255,255,0)',
                margin: { t: 50, b: 20, l: 20, r: 20 }
            };
            
            try {
                Plotly.newPlot('butterflyWings', allTraces, layout, {responsive: true, displayModeBar: false});
            } catch (error) {
                console.log('Error mostrando medidas Fibonacci:', error);
            }
        }

        function animateButterfly() {
            createButterfly();
            // Animaci√≥n de aleteo
            const container = document.getElementById('butterflyWings');
            if (container) {
                let scale = 1;
                let growing = true;
                const animate = () => {
                    if (growing) {
                        scale += 0.02;
                        if (scale >= 1.1) growing = false;
                    } else {
                        scale -= 0.02;
                        if (scale <= 0.95) growing = true;
                    }
                    container.style.transform = `scale(${scale})`;
                };
                
                const interval = setInterval(animate, 50);
                setTimeout(() => {
                    clearInterval(interval);
                    container.style.transform = 'scale(1)';
                }, 2000);
            }
        }

        // Calculadora de Fibonacci
        function calculateFibonacci() {
            const n = parseInt(document.getElementById('fibInput').value);
            if (n >= 0 && n <= 50) {
                const result = fibonacciOptimized(n);
                document.getElementById('fibResult').textContent = `F(${n}) = ${result.toLocaleString()}`;
            } else {
                document.getElementById('fibResult').textContent = 'Ingresa un n√∫mero entre 0 y 50';
            }
        }

        // Calcular proporci√≥n √°urea
        function updateGoldenRatio() {
            const phi = (1 + Math.sqrt(5)) / 2;
            document.getElementById('goldenRatio').textContent = phi.toFixed(12) + '...';
        }

        // Event Listeners
        function setupEventListeners() {
            // Slider de meses para conejos
            const monthSlider = document.getElementById('monthSlider');
            if (monthSlider) {
                monthSlider.addEventListener('input', function() {
                    const month = this.value;
                    document.getElementById('currentMonth').textContent = month;
                    
                    const months = document.querySelectorAll('.rabbit-month');
                    months.forEach((monthDiv, index) => {
                        if (index < month) {
                            monthDiv.style.opacity = '1';
                            monthDiv.style.transform = 'scale(1)';
                            monthDiv.style.background = 'linear-gradient(135deg, rgba(78, 205, 196, 0.4), rgba(69, 183, 209, 0.4))';
                        } else {
                            monthDiv.style.opacity = '0.3';
                            monthDiv.style.transform = 'scale(0.9)';
                            monthDiv.style.background = 'linear-gradient(135deg, rgba(78, 205, 196, 0.1), rgba(69, 183, 209, 0.1))';
                        }
                    });
                });
            }

            // Slider de t√©rminos
            const termsSlider = document.getElementById('termsSlider');
            if (termsSlider) {
                termsSlider.addEventListener('input', function() {
                    document.getElementById('termsCount').textContent = this.value;
                });
            }

            // Slider de semillas del girasol
            const seedSlider = document.getElementById('seedSlider');
            if (seedSlider) {
                seedSlider.addEventListener('input', function() {
                    document.getElementById('seedCount').textContent = this.value;
                });
            }

            // Slider del √°rbol con informaci√≥n actualizada
            const treeLevel = document.getElementById('treeLevel');
            if (treeLevel) {
                treeLevel.addEventListener('input', function() {
                    const level = parseInt(this.value);
                    const fibValue = fibonacciOptimized(level);
                    
                    document.getElementById('treeLevelText').textContent = `${level} (F(${level}) = ${fibValue} ramas)`;
                    document.getElementById('currentTreeLevel').textContent = level;
                    document.getElementById('branchCount').textContent = fibValue;
                    document.getElementById('fibIndex').textContent = level;
                    document.getElementById('fibValue').textContent = fibValue;
                });
            }

            // Checkboxes de espirales del girasol
            const spiralClockwise = document.getElementById('showSpiralsClockwise');
            const spiralCounterclockwise = document.getElementById('showSpiralsCounterclockwise');
            
            if (spiralClockwise) {
                spiralClockwise.addEventListener('change', function() {
                    createSunflower();
                });
            }
            
            if (spiralCounterclockwise) {
                spiralCounterclockwise.addEventListener('change', function() {
                    createSunflower();
                });
            }

            // Interactividad con n√∫meros de Fibonacci
            document.addEventListener('click', function(e) {
                if (e.target.classList.contains('fib-number')) {
                    e.target.style.transform = 'scale(1.5) rotate(720deg)';
                    setTimeout(() => {
                        e.target.style.transform = 'scale(1)';
                    }, 800);
                }
            });
            document.addEventListener('click', function(e) {
                if (e.target.classList.contains('fib-number')) {
                    e.target.style.transform = 'scale(1.5) rotate(720deg)';
                    setTimeout(() => {
                        e.target.style.transform = 'scale(1)';
                    }, 800);
                }
            });

            // Cerrar modal al hacer clic fuera
            window.addEventListener('click', function(event) {
                const modal = document.getElementById('colorModal');
                if (event.target === modal) {
                    closeColorModal();
                }
            });
        }

        // Inicializaci√≥n principal
        async function initializeApp() {
            try {
                await waitForPlotly();
                
                initFibonacciSequence();
                initRabbits();
                calculateFibonacci();
                updateGoldenRatio();
                resetColors();
                
                setupEventListeners();
                
                setTimeout(async () => {
                    await createChart();
                    await drawFibonacciSpiral();
                    await createSunflower();
                    await createAllFlowers();
                    createTree();
                    await createButterfly();
                }, 1000);
                
            } catch (error) {
                console.log('Error inicializando aplicaci√≥n:', error);
            }
        }

        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializeApp);
        } else {
            initializeApp();
        }
    </script>
</body>
</html>